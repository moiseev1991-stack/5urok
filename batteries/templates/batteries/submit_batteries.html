{% extends 'batteries/base.html' %}
{% load static %}

{% block title %}–°–¥–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤{% endblock %}

{% block content %}
<h1 style="text-align: center; margin-bottom: 30px;">üì¶ –°–¥–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h1>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 30px;">
    <div style="background-color: #0d1117; border: 1px solid #30363d; padding: 20px; border-radius: 6px; text-align: center;">
        <h3 style="color: #58a6ff; margin-bottom: 10px;">{{ user_total }}</h3>
        <p style="color: #8b949e;">–í–∞—à–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
    </div>
    <div style="background-color: #0d1117; border: 1px solid #30363d; padding: 20px; border-radius: 6px; text-align: center;">
        <h3 style="color: #58a6ff; margin-bottom: 10px;">{{ user_count }}</h3>
        <p style="color: #8b949e;">–í–∞—à–∏—Ö —Å–¥–∞—á</p>
    </div>
</div>

{% if user_stats_by_type %}
<div style="margin-bottom: 30px; background-color: #0d1117; border: 1px solid #30363d; padding: 20px; border-radius: 6px;">
    <h3 style="color: #f0f6fc; margin-bottom: 16px; font-size: 18px;">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º:</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
        {% for stat in user_stats_by_type %}
        {% if stat.device_type == 'battery' %}
            {% with device_name='–ë–∞—Ç–∞—Ä–µ–π–∫–∏' %}
        <div style="background-color: #161b22; border: 1px solid #30363d; padding: 12px; border-radius: 6px;">
            <p style="color: #58a6ff; font-weight: 600; margin-bottom: 4px;">{{ stat.total }}</p>
            <p style="color: #8b949e; font-size: 14px;">{{ device_name }}</p>
        </div>
            {% endwith %}
        {% elif stat.device_type == 'lamp' %}
            {% with device_name='–õ–∞–º–ø—ã' %}
        <div style="background-color: #161b22; border: 1px solid #30363d; padding: 12px; border-radius: 6px;">
            <p style="color: #58a6ff; font-weight: 600; margin-bottom: 4px;">{{ stat.total }}</p>
            <p style="color: #8b949e; font-size: 14px;">{{ device_name }}</p>
        </div>
            {% endwith %}
        {% elif stat.device_type == 'powerbank' %}
            {% with device_name='Power Banks' %}
        <div style="background-color: #161b22; border: 1px solid #30363d; padding: 12px; border-radius: 6px;">
            <p style="color: #58a6ff; font-weight: 600; margin-bottom: 4px;">{{ stat.total }}</p>
            <p style="color: #8b949e; font-size: 14px;">{{ device_name }}</p>
        </div>
            {% endwith %}
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}

<div style="max-width: 600px; margin: 0 auto;">
    <h2 style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–¥–∞—á—É</h2>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ form.device_type.id_for_label }}">{{ form.device_type.label }}</label>
            {{ form.device_type }}
            {% if form.device_type.errors %}
                <div style="color: #f85149; margin-top: 5px; font-size: 14px;">{{ form.device_type.errors }}</div>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.quantity.id_for_label }}">{{ form.quantity.label }}</label>
            {{ form.quantity }}
            {% if form.quantity.errors %}
                <div style="color: #f85149; margin-top: 5px; font-size: 14px;">{{ form.quantity.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.date_submitted.id_for_label }}">{{ form.date_submitted.label }}</label>
            {{ form.date_submitted }}
            {% if form.date_submitted.errors %}
                <div style="color: #f85149; margin-top: 5px; font-size: 14px;">{{ form.date_submitted.errors }}</div>
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%;">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
</div>

{% if recent_submissions %}
<div style="margin-top: 40px;">
    <h2 style="margin-bottom: 20px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–∞—á–∏</h2>
    <table>
        <thead>
            <tr>
                <th>–¢–∏–ø</th>
                <th>–î–∞—Ç–∞ —Å–¥–∞—á–∏</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            </tr>
        </thead>
        <tbody>
            {% for submission in recent_submissions %}
            <tr>
                <td>
                    {% if submission.device_type == 'battery' %}–ë–∞—Ç–∞—Ä–µ–π–∫–∏
                    {% elif submission.device_type == 'lamp' %}–õ–∞–º–ø—ã
                    {% elif submission.device_type == 'powerbank' %}Power Banks
                    {% else %}{{ submission.device_type }}{% endif %}
                </td>
                <td>{{ submission.date_submitted|date:"d.m.Y H:i" }}</td>
                <td>{{ submission.quantity }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div style="text-align: center; margin-top: 20px;">
        <a href="{% url 'profile' %}" class="btn btn-secondary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–¥–∞—á–∏</a>
    </div>
</div>
{% endif %}
{% endblock %}
